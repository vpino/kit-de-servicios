#!/bin/sh
# postinst script for kds
#
# see: dh_installdeb(1)

set -e

case "$1" in
    configure)
        
        echo "Colocando /etc/default/celeryd en /etc/kds/diverted/celeryd"
        dpkg-divert --divert /etc/kds/diverted/celeryd --rename /etc/default/celeryd

        echo "Instalando configuracion personalizada para Celeryd"
        ln /etc/kds/celeryd /etc/default/celeryd

        adduser --system --shell /bin/bash --gecos 'KDS system user' \
            --group --disabled-password --quiet --no-create-home kds

        rm -rf /var/log/celery
        rm -rf /var/run/celery
        
		service nginx restart
		service uwsgi restart || true
        service rabbitmq-server restart
        service celeryd restart
    ;;

    abort-upgrade|abort-remove|abort-deconfigure)
    ;;

    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
